pipeline {
    agent any  // 使用任意可用节点

    stages {
        // 阶段1：清除错误代理配置 + 拉取代码（自动使用 Job 配置的凭据）
        stage('Checkout Code') {
            steps {
                // 清除可能存在的错误代理配置
                bat 'git config --global --unset http.proxy || echo "No proxy to unset"'
                bat 'git config --global --unset https.proxy || echo "No proxy to unset"'

                // 不需要手动 withCredentials，Jenkins 会自动使用 Job 配置的 Git 凭据
                checkout scm  // 自动拉取代码（使用 SCM 配置的仓库和凭据）
            }
        }

        // 阶段2：运行测试
        stage('Run Hello Test') {
            steps {
                bat 'python hello_test.py'
                bat 'dir /b'  // 验证文件列表
            }
        }
    }

    post {
        always {
            echo '测试完成，请查看控制台输出'
        }
    }
}